# Программирование на языке ассемблера ARM

## Инструментальные средства

Программы на языке ассемблера будут транслироваться с помощью GCC.
Исходный код программы должен находиться в файле `prog.s` или `prog.S`.
Файл с суффиксом `.S` перед трансляцией обрабатывается препроцессором языка Си.

Для трансляции программы в исполняемый код можно использовать команду:
```
gcc prog.s -o prog
```

При компоновке программы к ней будут прилинкованы файл начальной инициализации
и стандартная библиотека языка Си. Точка входа в программу на языке ассемблера
в этом случае будет такая же, как и в случае языка Си - `main`.

Также можно использовать функции стандартной библиотеки языка Си,
например, `scanf` или `printf`.

## Структура файла программы

Комментарии в файле записываются в стиле языка Си, то есть либо
```
 // комментарий до конца строки
```

или

```
/*
блочный комментарий
*/
```

Программа на языке ассемблера состоит из последовательности инструкций процессора
и директив ассемблера. Каждая инструкция или директива ассемблера занимает одну строку текста.

Программа на ассемблере состоит из нескольких секций. Основные секции следующие:

Секция `.text` содержит машинный код программы (инструкции процессора). Кроме этого
в эту секцию могут помещаться константные данные (таблицы переходов, таблицы виртуальных
функций, строки). Поэтому нельзя сказать, что каждая ячейка памяти в секции `.text`
содержит инструкцию процессора. При выполнении программы секция `.text` доступна только
на чтение и выполнение. Модифицировать память нельзя - программа будет завершена с
ошибкой обращения к памяти.

Секция `.data` содержит глобальные переменные. При выполнении программы секция `.data`
доступна на чтение и запись, но не на выполнение.

Секция `.bss` содержит глобальные переменные, место под которые зарезервировано,
но сами переменные будут проинициализированы нулями при запуске программы на выполнение.
Секция `.bss` не занимает места в исполняемом файле программы, в отличие от секции `.data`.

По умолчанию, компилятор языка Си помещает в `.bss` глобальные переменные, которые не были
инициализированы явно. Например, массив

```
char arr1[1024*1024];
```
будет помещен компилятором Си в секцию `.bss`, и поэтому не будет занимать место в исполняемой
программе, а массив

```
char arr1[1024*1024] = { 0 };
```
будет помещен компилятором в секцию `.data`, что отразится на размере сгенерированного исполняемого файла.

В файле исходного кода секции могут быть перемешаны в произвольном порядке. Ассемблер разместит все фрагменты исходного
кода, относящиеся к одной секции, в памяти последовательно. Например,

```
        .text
        .int    1
        .data
        .int    2
        .text
        .int    3
        .data
        .int    4
```

Сначала в памяти будет размещена вся секция `.text`, а в ней последовательно будут размещены директивы
```
        .int    1
        .int    3
```

Затем в памяти будет размещена вся секция `.data`.

Когда исполняемый файл компонуется из нескольких объектных модулей, компоновщик ld также выполняет слияние
одноименных секций из всех объектных файлов, поданных ему на вход, в одну секцию в исполняемом файле.
То есть все секции `.text` в объектных файлах будут слиты и помещены в одну секцию `.text` в исполняемом файле,
и аналогично с другими секциями.
